---
layout: post
title: "npm + gulp + webpack これだけ抑えておけばOK"
outline: ""
categories: ["npm", "gulp",  "Webpack"]
---

最近はJavaScriptをES6で書いたり、cssをscssで書いたりするのが当たり前になってきました。そうなると必然的に必要になるのがビルド。ビルドの仕組みも充実してきていて、単にトランスパイルするだけでなく、構文チェックしたり圧縮したり、[CSSスプライト](http://lopan.jp/css-sprites/)をつくるようなことまでできたりします。

で、このビルド環境、新規Project立ち上げる度に用意するのが面倒くさいので、自分用の雛形をつくりました。今回はその中身を紹介します。



### ビルドの中身

- ES6 → ブラウザで動かせるJavaScriptにする
- scssをcssにする
- jsとcssはそれぞれ結合して圧縮する(.min.js/.min.cssをつくる)
- 変更を検知して自動ビルドする

雛形なので特別なことはしません。新しく何かつくりたいと思ったときにすぐに作れるようなビルド環境を用意するだけです。デバッグ用にトランスパイルしただけのものと、リリース用に結合して圧縮したものの両方をつくれるようにします。


### たったひとつのこだわり

基本的に使うツールは何でもいいのですが(依存したくないので)…ひとつだけ。**npmさえインストールされていれば動く** ものにします。理由は2つ。

1. npmは今後もしばらく廃れないだろうという安易な予想
2. 余計なものをグローバルインストールしたくない(させたくない)

あろえは仕事用PCとプライベート用PCのどちらでも開発をしますが、それぞれに入っているツールの種類もバージョンも違います。もちろん共同開発者たちのPCについても然り。

そんな状況では、ツールのバージョンによって動作が変わりかねないし、二重にインストールさせてバージョンぐちゃぐちゃとかバージョンが競合して動かなくなったとか、何かしらが起きます。ハラハラ😱です。

つまるところ、**人のグローバルを侵すな** という話です。

というわけで、ビルドコマンドは`package.json`に集約して、すべてnpmコマンドで動くようにしました。


### ソース
中身を全部確認したい場合は【[aloerina01/short-code  - GitHub](https://github.com/aloerina01/short-code)】へ。

ここではポイントとなる部分を抜粋紹介します。

#### package.json

<script src="https://gist.github.com/aloerina01/04e8dd2903509a0e23b0a0b0f5d32ebe.js"></script>

`package.json`の`scripts`部分です。gulpコマンドをここに書いています。これらのコマンドは全部`$ npm run XXX`というかたちで実行できます。

```
$ npm run build
```

node_modules以下にあるモジュールについてのパス解決をしてくれているので、`gulp-cli`をグローバルインストールしていなくてもnpmを経由してgulpコマンドを実行できるのです。同様にwebpackのコマンドなんかも実行できます。

#### gulpfile.js

<script src="https://gist.github.com/aloerina01/1e876b9beb99e46a2fa2458ce09432a7.js"></script>

そしてこれがコマンドたち。一部のコマンドです。`gulp-plumber`でエラーハンドリングをした上で、①lint、②Webpackでのトランスパイル、③distディレクトリに書き出し、をしています。

それをwatchさせた上で、defaultコマンドに登録しています。
