---
layout: post
title: ES6 Proxy ã‚’ã¤ã‹ã£ã¦å …ç‰¢ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã¤ãã‚‹Tips
outline: ES6ã®ä»•æ§˜ã®ã²ã¨ã¤ã§ã‚ã‚‹Proxyã‚’ä½¿ã£ã¦ã€å …ç‰¢ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚Privateå¤‰æ•°ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€Immutableãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€Singletonãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€Enumã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã®ã§ã”å‚è€ƒã¾ã§ã«ã€‚
categories: [JavaScript]
---

### What is Proxy

> The Proxy object is used to define custom behavior for fundamental operations (e.g. property lookup, assignment, enumeration, function invocation, etc).

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ©ãƒƒãƒ—ã—ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒã¤åŸºæœ¬çš„ãªæ©Ÿèƒ½(`obj.key`ã¨æ›¸ã„ã¦valueã‚’å–å¾—ã™ã‚‹æ©Ÿèƒ½ãªã©)ã‚’ä¸Šæ›¸ãã“ã¨ãŒã§ãã‚‹ã®ãŒ`Proxy Object`ã§ã™ã€‚  
(é«˜æ©Ÿèƒ½ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€ã‘ã£ã“ã†ã‚¤ã‚«ã—ãŸä»•æ§˜ã ã¨æ€ã„ã¾ã™ğŸ˜‹)


#### ã¤ã‹ã„ã‹ãŸ

è©³ç´°ãªç”¨æ³•ã‚„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¬æ˜ã¯ [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy)ã«ä»»ã›ã‚‹ã¨ã—ã¦ã€åŸºæœ¬çš„ãªSyntaxã ã‘è¨˜ã—ã¾ã™ã€‚

```js
let proxy = new Proxy(target, handler);
```

* `target` â€¦Proxyã§ãƒ©ãƒƒãƒ—ã™ã‚‹å¯¾è±¡ã¨ãªã‚‹Object
* `handler`â€¦ä¸Šæ›¸ãé–¢æ•°ã‚’ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«æŒã¤Object


#### ç”¨ä¾‹

å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚’ã¿ãŸã»ã†ãŒãƒ”ãƒ³ã¨ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ğŸ’¡

```js
let obj = {
  name: 'Aloerina',
  age: 17
};

const handler = {
  set: function(target, prop, value) {
    console.error(`${prop}ã¯ä¸Šæ›¸ãç¦æ­¢ã§ã™`);
  }
};

let proxy = new Proxy(obj, handler);  // objã‚’ãƒ©ãƒƒãƒ—ã—ãŸproxyã‚’ç”Ÿæˆã™ã‚‹

proxy.name = 'Margherita';  // nameã¯ä¸Šæ›¸ãç¦æ­¢ã§ã™
concole.log(proxy.name);    // Aloerina
```


#### Handlerã®ç¨®é¡

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒã¤åŸºæœ¬çš„ãªæ©Ÿèƒ½ã€ã¤ã¾ã‚Šã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã€ã®ã“ã¨ã‚’**ãƒˆãƒ©ãƒƒãƒ—**ã¨ã„ã„ã¾ã™ã€‚  
handlerã¨ã¯ã€ãƒˆãƒ©ãƒƒãƒ—ã®å‡¦ç†ã‚’ä¸Šæ›¸ãã™ã‚‹ã‚‚ã®ãªã®ã§ã€å„ãƒˆãƒ©ãƒƒãƒ—ã«å¯¾ã—ã¦å¯¾å¿œã™ã‚‹handlerãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ã€ŒProxyã§ä½•ãŒã§ãã‚‹ã‹ã€ã‚’çŸ¥ã‚ŠãŸã„ã¨ãã¯ã“ã‚Œã‚’è¦‹ã‚‹ã®ãŒåˆ†ã‹ã‚Šã‚„ã™ãã†ã§ã™ã€‚

| handler    | trap    |
|---|---|
| [handler.getPrototypeOf(target)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getPrototypeOf)   | Object.getPrototypeOf   |
| [handler.setPrototypeOf(target, prototype)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/setPrototypeOf)   | Object.setPrototypeOf   |
| [handler.isExtensible(target)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/isExtensible)   | Object.isExtensible   |
| [handler.preventExtensions(target)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/preventExtensions)   | Object.preventExtensions   |
| [handler.getOwnPropertyDescriptor(target, prop)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getOwnPropertyDescriptor)   | Object.getOwnPropertyDescriptor   |
| [handler.defineProperty(target, prop, descriptor)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/defineProperty)   | Object.defineProperty   |
| [handler.has(target, prop)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/has)   | _in_ operator   |
| [handler.get(target, prop, receiver)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get)   | getting property values   |
| [handler.set(target, prop, value, receiver)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/set)   | setting property values   |
| [handler.deleteProperty(target, prop)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/deleteProperty)   | _delete_ operator   |
| [handler.ownKeys(target)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/ownKeys)   | Object.getOwnPropertyNames<br>Object.getOwnPropertySymbols   |
| [handler.apply(target, thisArg, argumentsList)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/apply)   | function call   |
| [handler.construct(target, argumentsList, newTarget)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/construct)   | _new_ operator   |


#### Reflect

handlerã®ä¸­ã§ã€Œæœ¬æ¥ã®å‡¦ç†ã‚’å‘¼ã³å‡ºã—ãŸã„ã€å ´é¢ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã“ã®å ´åˆã«ä½¿ãˆã‚‹ã®ãŒ`Reflect`ã§ã™ã€‚`handler`ã¨åŒã˜ãƒ¡ã‚½ãƒƒãƒ‰ç¾¤ã‚’æŒã¡ã¾ã™ã€‚

```js
const handler = {
  set: function(target, prop, value) {
    console.log('Before set');
    Reflect.set(target, prop, value);  // targetã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®setterã‚’å‘¼ã³å‡ºã™
  }
};

let proxy = new Proxy({}, handler);

proxy.name = 'Margherita';  // Before set
concole.log(proxy.name);    // Margherita
```

ä»¥ä¸Šã€ã–ã£ã¨Proxyã®ä½¿ã„æ–¹ã§ã—ãŸã€‚ã“ã“ã‹ã‚‰ã¯Proxyã®å®Ÿç”¨ä¾‹ã®è©±ã§ã™ã€‚


### [Tips] EnumObjectã‚’ã¤ãã‚‹ï¼ EnumBuilder

Enumã®å®šç¾©ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ã†ã“ã¨ã‚±ãƒ¼ã‚¹ã€‚ã‚ˆãã‚ã‚Šã¾ã™ã€‚  
ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒEnumã§ã‚ã‚‹ä»¥ä¸Šã€**å€¤ãŒæ›¸ãæ›ãˆã‚‰ã‚Œãªã„ã“ã¨**ãŒå³å¯†ã«ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã¨è‰¯ã„ã§ã™ã€‚ã¨ã„ã†ã“ã¨ã§ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒEnumã¨ã—ã¦ç”Ÿã¾ã‚Œå¤‰ã‚ã‚‹`EnumBuilder`ã‚’ã¤ãã£ã¦ã¿ã¾ã—ãŸã€‚
<script src="https://gist.github.com/aloerina01/9c931d3918242767b9c9729a63b0952f.js"></script>


* `set / delete`ãŒã§ããªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã™ã‚‹
* `import`ã—ã¦`Type.Inport`ã®ã‚ˆã†ã«ã‚¹ã‚¿ãƒ†ã‚£ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹é¢¨ã«ä½¿ãˆã‚‹
* æ—¢ã«ä½œã‚‰ã‚Œã¦ã„ã‚‹Enumç”¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚ç°¡å˜ã«é©ç”¨ã§ãã‚‹
* ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå…¥ã‚Œå­ã«ãªã‚‹ã‚±ãƒ¼ã‚¹ã¯æƒ³å®šã—ã¦ãªã„

ã¨ã„ã£ãŸã“ã¨ã‚’æº€ãŸã™ä»•æ§˜ã«ã—ãŸãã¦ã“ã®ã‚ˆã†ãªå½¢ã«ã—ã¾ã—ãŸã€‚ãŸã ã€æ¸¡ã™ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã“ã‚Œä»¥ä¸Šå¢—ãˆãªã•ãã†ãªã®ã§Builderãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã™ã‚‹ã®ã¯éå‰°ãªå®Ÿè£…ã ã£ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã™ã¿ã¾ã›ã‚“å¥½ã¿ã§ã™ğŸ™‡


### [Tips] ç”¨é€”åˆ¥ã«åˆ¶ç´„ä»˜ãModuleã‚’å®šç¾©ã—ã¦ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ãªå®Ÿè£…ã‚’ã™ã‚‹ï¼

classæ§‹æ–‡ã§ç”¨æ„ã—ãŸModuleã‚’`import`ã—ã¦`new`ã—ã¦ä½¿ã†ã¨æœ¬å½“ã«ã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦ã‚‹ã‚ˆã†ã«è¦‹ãˆã¦ã€èª­ã¿ã‚„ã™ã„ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹(é¢¨)ã®å®Ÿè£…ã¨ãªã‚Šã¾ã™ã‚ˆã­ã€‚  
ã—ã‹ã—å®Ÿéš›ã«ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚ŒãŸã‚½ãƒ¬ã¯ãŸã ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚ã‚„ã‚ã†ã¨æ€ãˆã°functionã‚’å¤–ã‹ã‚‰è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚ã€privateãªç”¨é€”ã§ç”¨æ„ã—ãŸå¤‰æ•°ã‚’å¼·å¼•ã«æ›¸ãæ›ãˆã‚‹ã“ã¨ã‚‚ã§ãã¦ã—ã¾ã„ã¾ã™ã€‚

```js
import User from './User';

let user01 = new User();
user01._name = 'Aloerina';        // ã‚„ã‚ã¦ãƒ¼ï¼ privateç”¨ã®å¤‰æ•°ã‚’æ›¸ãæ›ãˆãªã„ã§ãƒ¼ï¼
```

ã“ã†ãªã£ã¦ã—ã¾ã†ã¨æ‚²æƒ¨ãªã®ã§ğŸ˜­ã€**Moduleæ¯ã®æ€§è³ªã«å¿œã˜ã¦æ©Ÿèƒ½ã‚’åˆ¶ç´„ã—ã€ä¸æœ¬æ„ãªä½¿ã‚ã‚Œæ–¹ã‚’é˜²ã**ãŸã‚ã€

1. Privateå¤‰æ•°ã‚’æŒã¤Module
2. Immutableãªå€¤ã‚’å®šç¾©ã™ã‚‹Module
3. SingletonãªModule

ã®3ãƒ‘ã‚¿ãƒ¼ãƒ³ã®Moduleã‚’å®šç¾©ã™ã‚‹ãŸã‚ã®`ModuleBuilder`ã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚

<script src="https://gist.github.com/aloerina01/1fa30b0d81384681a4480d80e69893fe.js"></script>

* æ—¢ã«ä½œã‚‰ã‚Œã¦ã„ã‚‹Moduleã«ã‚‚é©ç”¨ã§ãã‚‹
* Moduleã®ã‚½ãƒ¼ã‚¹å†…ã«ã€ã©ã®æ€§è³ªã‚’æŒã£ã¦ã„ã‚‹ã®ã‹ãŒæ˜è¨˜ã•ã‚Œã¦ã„ã‚‹
* ä»Šã¾ã§é€šã‚ŠModuleã‚’`import`ã—ã¦`new`ã—ã¦ä½¿ãˆã‚‹ã€‚å‘¼ã³å‡ºã—å´ã§ä¿®æ­£ãŒä¸è¦(singletonã¯é™¤ã)
* ä¸Šè¨˜3ã¤ä»¥å¤–ã«ã‚‚ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ‹¡å¼µã§ãã‚‹

ã¨ã„ã£ãŸã“ã¨ã‚’æ„è­˜ã—ã¦ã¤ãã£ã¦ã¿ã¾ã—ãŸã€‚Builderãƒ‘ã‚¿ãƒ¼ãƒ³ãªã®ã¯è¨€ã‚ãšã‚‚ãŒãªã€‚  
ä»»æ„ã®ã‚¯ãƒ©ã‚¹ã¨ç”¨æ„ã•ã‚ŒãŸhandlerã‚’é¸æŠã—ã¦Builderã«æ¸¡ã—ã€å‡ºæ¥ä¸ŠãŒã£ãŸProxyã‚’Moduleã¨ã—ã¦Exportã•ã›ã¦ä½¿ã„ã¾ã™ã€‚ä»¥ä¸‹ã«å®Ÿç”¨ä¾‹ã‚’2ã¤æŒ™ã’ã¾ã™ã€‚

#### Immutableãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

<script src="https://gist.github.com/aloerina01/2d3a998bc7dc8f90c91ddc318e50214a.js"></script>

#### Singletonãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

<script src="https://gist.github.com/aloerina01/d9537a60291363555b95df5c33a4f9da.js"></script>

ã¡ãªã¿ã«ã€è¨­è¨ˆå½“åˆã¯`Handlers`ã‚’çµ„ã¿åˆã‚ã›ã¦ã„ã‚ã‚“ãªæ€§è³ªã‚’æŒã¤Moduleã‚’ã¤ãã‚Œã‚‹ã‚ˆã†ã«ã—ãŸã„(Javaã®[lombok](http://dev.classmethod.jp/server-side/java/use_lombok_short/)ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¿ãŸã„ãªæ„Ÿã˜ã§ç°¡å˜ã«ä»˜ä¸ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„)ã¨æ€ã£ã¦ã„ãŸã®ã§ã™ãŒã€handlerã®ä¸Šæ›¸ããŒèµ·ãã‚‹ã®ã§ã‚„ã‚ã¾ã—ãŸâ€¦ã€‚


### ãŠã‚ã‚Šã«

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒã¤åŸºæœ¬æ©Ÿèƒ½ã‚’ä¸Šæ›¸ãã“ã¨ã§JavaScriptç‰¹æœ‰ã®è‡ªç”±ã•ã«åˆ¶é™ã‚’è¨­ã‘ã¦å …ç‰¢ãªå®Ÿè£…ã‚’ã—ã‚ˆã†ï¼ ã¨ã„ã†ãŠè©±ã§ã—ãŸã€‚

ã¨ã¯è¨€ãˆã€ã‚„ã‚„å¼·å¼•ãªå®Ÿè£…ãªã®ã§ç²—ãŒã‚ã‚‹ã“ã¨ã‚‚äº‹å®Ÿã§ã™(ä¸Šè¨˜ã®ä¾‹ã§ã¯Singletonã®å®Ÿè£…ã¯å¾®å¦™ã€‚ãã‚‚ãã‚‚JSã§Singletonãªã‚“ã¦ä½¿ã‚ãªãã¦ã‚‚ã„ã„ã‹ã‚‚ãªã¨æ€ã£ãŸã‚Šâ€¦)ã€‚  
**ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ãªæ›¸ãæ–¹ã‚’ã‚´ãƒªæŠ¼ã—ã§å®Ÿç¾ã—ã¦ã„ã‚‹**ã¨ã‚‚è¨€ãˆã‚‹ã®ã§ã€ãã‚‚ãã‚‚JavaScriptã®å®Ÿè£…ã¨ã—ã¦ãµã•ã‚ã—ã„ã‹ã¨ã„ã†è­°è«–ã®ä½™åœ°ã¯ã‚ã‚Šãã†ã§ã™ã€‚

ãŸã ã€ãã†ã„ã£ãŸç‚¹ã‚‚è¸ã¾ãˆãŸä¸Šã§ä½¿ã†ã®ã§ã‚ã‚Œã°å¼·åŠ›ãªåŠ¹æœã‚’ç™ºæ®ã—ã¦ãã‚Œã‚‹ã®ãŒProxyã ã¨æ€ã„ã¾ã™ã€‚ä»Šå›ã¯è‡ªåˆ†ã§è©¦ç”¨ã—ã¦ã¿ãŸã‚‚ã®ã ã‘ã‚’ã¾ã¨ã‚ã¾ã—ãŸãŒã€ä»–ã«ã‚‚æœ‰ç”¨ãªä½¿ã„æ–¹ã¯ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆãŒå‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚

[ES6 Features - 10 Use Cases for Proxy](http://dealwithjs.io/es6-features-10-use-cases-for-proxy/)

ã‚‚ã£ã¨è‰¯ã„å®Ÿè£…ãŒã‚ã‚‹ã€é–“é•ã£ã¦ã„ã‚‹éƒ¨åˆ†ãŒã‚ã‚‹ã€ã¨ã„ã†å ´åˆã¯ãœã²[@aloerina_](https://twitter.com/aloerina_) ã¾ã§ã”ä¸€å ±ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚

ç¾å ´ã‹ã‚‰ã¯ä»¥ä¸Šã§ã™ã€‚
