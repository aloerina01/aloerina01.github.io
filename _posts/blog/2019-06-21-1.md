---
title: Babel7.4ã§éæ¨å¥¨ã«ãªã£ãŸbabel/polyfillã®ä»£æ›¿æ‰‹æ®µã¨è¨­å®šæ–¹æ³•
outline: Babel7.4.0ã‹ã‚‰ @babel/preset-env ã¨ @babel/plugin-transform-runtime ãŒ core-js@3 ã«å¯¾å¿œã—ã¾ã—ãŸã€‚ã¾ãŸ @babel/polyfill ãŒéæ¨å¥¨ã«ãªã‚Šã€ã“ã‚Œã‚‰ã®å¤‰æ›´ã«ã‚ˆã£ã¦polyfillã®è¨­å®šæ–¹æ³•ãŒå°‘ã—å¤‰ã‚ã£ãŸã®ã§ã€ãã®å†…å®¹ã‚’ãƒ¡ãƒ¢ã—ã¾ã—ãŸã€‚
categories: [JavaScript, Babel]
---

Babel7.4.0 ã‹ã‚‰ã€é•·ã„ã“ã¨ãŠä¸–è©±ã«ãªã£ã¦ããŸ @babel/polyfill ãŒéæ¨å¥¨ã¨ãªã‚Šã¾ã—ãŸã€‚åŠ ãˆã¦ã€@babel/preset-env ã¨ @babel/ransform-runtime ãŒ core-js@3 ã«å¯¾å¿œã—ãŸã‚ˆã†ã§ã™ğŸ‰  
ã“ã‚Œã‚‰ã«ä¼´ã„polyfillå‘¨ã‚Šã®è¨­å®šæ–¹æ³•ãŒå¤‰ã‚ã£ãŸã®ã§ã€ãã®å†…å®¹ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™ã€‚

* TOC
{:toc}

### Babel ã¨ core-js ã®é–¢ä¿‚ã®ãŠã•ã‚‰ã„

BabelãŒæä¾›ã™ã‚‹ @babel/polyfill ã‚„ @babel/preset-env ãªã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã¨

* built-ins objects(Promise, WeakMapç­‰)
* static methods(Object.assign, Array.fromç­‰)
* instance methods(Array.prototype.includesç­‰)

ã¨ã„ã£ãŸæ–°ã—ã„æ©Ÿèƒ½ã‚’ä½¿ã£ãŸå®Ÿè£…ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã‚ˆã­ã€‚ã“ã‚Œã‚‰ã®Babelãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ **core-js** ãŒæä¾›ã™ã‚‹polyfillã‚’å†…éƒ¨çš„ã«èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚ç‰¹ã« **@babel/polyfill ã¯ core-js ã¨ regenerator-runtime ã‚’æŸã­ã¦æä¾›ã™ã‚‹polyfillé›†**ã§ã™ã€‚

Babel7.4.0ã‹ã‚‰ã¯ã“ã® @babel/polyfill ãŒéæ¨å¥¨ã«ãªã‚Šã€ä»£ã‚ã‚Šã«**core-jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ç›´æ¥èª­ã¿è¾¼ã‚€**æ–¹æ³•ãŒææ¡ˆã•ã‚Œã¦ã„ã¾ã™ã€‚


### ã“ã‚Œã‹ã‚‰ã®polyfillè¨­å®šæ–¹æ³•
#### 1. preset-env ã¨ useBuiltIns:usage ã§å¿…è¦ãªpolyfillã ã‘èª­ã¿è¾¼ã‚€æ–¹æ³•

@babel/preset-env ã¯(æŒ‡å®šã—ãŸå®Ÿè¡Œç’°å¢ƒã«ã‚ã‚ã›ãŸ)å¿…è¦ãªæ§‹æ–‡å¤‰æ›ã‚„ã€polyfillã®èª­ã¿è¾¼ã¿ã‚’ã—ã¦ãã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚ãã—ã¦ã“ã®presetã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®`useBuiltins`ã§ã€Œ**ã©ã®ã‚ˆã†ã«polyfillã‚’èª­ã¿è¾¼ã‚€ã‹**ã€ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

`useBuiltIns: usage`ã¨ã—ã€å¿…è¦ãªpolyfillã ã‘ã‚’èª­ã¿è¾¼ã‚€è¨­å®šä¾‹ã‹ã‚‰è¦‹ã¦ã„ãã¾ã™ã€‚

**@babel/prest-env ã‚’installã™ã‚‹**
```shell
npm install -D @babel/preset-env
```

<p></p>

**.babelrc ã¾ãŸã¯ babel.config.js ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹**
```js
  presets: [
    ["@babel/preset-env", {
       useBuiltIns: "usage",
       corejs: 3 // or 2
    }]
  ]
```
<p></p>

**æŒ‡å®šã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® core-js ã‚’installã™ã‚‹**
```shell
npm install -S core-js@3  # or core-js@2
```

<p></p>

`useBuiltIns: usage`ã¨ã™ã‚‹ã¨ã€ã‚³ãƒ¼ãƒ‰å†…ã‹ã‚‰polyfillãŒå¿…è¦ãªç®‡æ‰€ã‚’å‹æ‰‹ã«åˆ¤æ–­ã—ã€å¿…è¦ãªcore-jsã‚’å‹æ‰‹ã«importã—ã¦ãã‚Œã¾ã™ã€‚ã“ã®ã¨ãã€**core-js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚ä½µã›ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã—ã€ãã‚Œã«å¿œã˜ãŸ core-js ã‚’npm installã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹**ã‚ã‘ã§ã™ã­ã€‚

ã¡ãªã¿ã«åŸ·ç­†æ™‚ç‚¹ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯`useBuiltIns: usage`ã¯ã¾ã **experimental**ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€core-js@3 ã§ã¯å¤šãã®å•é¡ŒãŒè§£æ¶ˆã•ã‚Œã¦ã„ã¦ã‚‚ã¯ã‚„experimentalã§ã¯ãªã„ã ã‚ã†â€¦[ã¨ã®ã“ã¨](https://github.com/babel/website/pull/1987/files#r265777607){:target="_blank"}ã§ã™ã€‚



#### 2. preset-env ã¨ useBuiltIns:entry ã§å…¨polyfillã‚’èª­ã¿è¾¼ã‚€æ–¹æ³•

ä¸Šè¨˜ã¨åŒæ§˜ã« @babel/preset-env ã‚’ä½¿ã†æ–¹æ³•ã§ã™ãŒã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å†…å®¹ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚`useBuiltIns: entry`ã¨ã—ã€index.js ãªã©ã®jsãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«ã¦polyfillã‚’importã™ã‚‹ã“ã¨ã§ã€å…¨éƒ¨ã®polyfillã‚’èª­ã¿è¾¼ã‚€æ–¹æ³•ã§ã™ã€‚

**@babel/prest-env ã‚’installã™ã‚‹**
```shell
npm install -D @babel/preset-env
```

<p></p>

**.babelrc ã¾ãŸã¯ babel.config.js ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹**
```js
  presets: [
    ["@babel/preset-env", {
       useBuiltIns: "entry",
       corejs: 3 // or 2
    }]
  ]
```

<p></p>

**æŒ‡å®šã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® core-js ã¨ regenerator-runtime ã‚’installã™ã‚‹**
```shell
npm install -S core-js@3  # or core-js@2
npm install -S regenerator-runtime
```

<p></p>

**jsãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã§ core-js ã¨ regenerator-runtime ã‚’importã™ã‚‹**
```js
import "core-js/stable";
import "regenerator-runtime/runtime";

// import "@babel/polyfill" ä»Šã¾ã§ã¯ã“ã†æŒ‡å®šã—ã¦ã„ã¾ã—ãŸã­
```

<p></p>

@babel/polyfill ã‚’importã—ã¦ã„ãŸé ƒã¨åŒã˜æ³¨æ„ã«ãªã‚Šã¾ã™ãŒã€core-js ã‚„ regenerator-runtime è¤‡æ•°å›importã™ã‚‹ã¨å•é¡ŒãŒèµ·ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã€bundleã•ã‚Œã‚‹jsã®å†’é ­ã§1åº¦ã ã‘importã™ã‚‹ã‚ˆã†ã«æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### 3. transform-runtime ã‚’ä½¿ã†æ–¹æ³•

@babel/plugin-transform-runtime ã‚’ä½¿ã£ã¦polyfillã‚’å…¥ã‚Œã‚‹ã¨ã€**globalãŒæ±šæŸ“ã•ã‚Œãªã„ãƒ¡ãƒªãƒƒãƒˆ**ãŒå¾—ã‚‰ã‚Œã‚‹åé¢ã€**instance methodsãŒä½¿ãˆãªã„ã¨ã„ã†ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**ãŒã‚ã‚Šã¾ã—ãŸã€‚ãŒã€core-js@3ã«å¯¾å¿œã—ãŸã“ã¨ã«ã‚ˆã‚Š**instance methodsãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™**ğŸ‰

è¨­å®šã®éš›ã¯ã€bundleã«çµ„ã¿è¾¼ã¾ã‚Œã‚‹ **@babel/runtime** ã¨ã€ãƒ“ãƒ«ãƒ‰æ™‚ã«polyfillå¤‰æ›ãªã©ã‚’æ‹…ã† **@babel/plugin-transform-runtime** ã‚’ç”¨æ„ã—ã¾ã™ã€‚

**@babel/runtime ã¨ @babel/plugin-transform-runtime ã‚’installã™ã‚‹**

```shell
npm install -S @babel/runtime
npm install -D @babel/plugin-transform-runtime
```

<p></p>

**.babelrc ã¾ãŸã¯ babel.config.js ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹**
```js
  presets: [
    ["@babel/plugin-transform-runtime", { corejs: 3 }]
  ]
```

<p></p>

**æŒ‡å®šã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® core-js ã‚’installã™ã‚‹**

```shell
npm install -S core-js@3
```


### Proposal ã®ä½¿ã„æ–¹

@babel/preset-env ã¾ãŸã¯ @babel/plugin-transform-runtime ã©ã¡ã‚‰ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã§ã‚ã£ã¦ã‚‚ã€core-js@3 ã§ã¯Proposalã®æ©Ÿèƒ½ã‚‚åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚è¨­å®šæ–¹æ³•ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å†…å®¹ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§ã™ã€‚

```js
// before
{ corejs: 3 }

// after
{ 
  corejs: {
    version: 3,
    proposals: true
  }
}
```

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€ŒECMAScriptã®ææ¡ˆã¯æœ¬è³ªçš„ã«ä¸å®‰å®šã§ã‚ã‚Šã€core-js@4 ã§ã¯å¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€ã¨ã®æ³¨æ„æ›¸ããŒã‚ã‚Šã¾ã™ã®ã§ã€ã”æ‰¿çŸ¥ãŠãã‚’ã€‚


###  å‚è€ƒ

*  [https://github.com/babel/website/pull/1987](https://github.com/babel/website/pull/1987){:target="_blank"}
*  [https://babeljs.io/docs/en/next/babel-polyfill.html](https://babeljs.io/docs/en/next/babel-polyfill.html){:target="_blank"}
*  [https://babeljs.io/docs/en/babel-plugin-transform-runtime](https://babeljs.io/docs/en/babel-plugin-transform-runtime){:target="_blank"}
*  [https://babeljs.io/docs/en/babel-preset-env](https://babeljs.io/docs/en/babel-preset-env){:target="_blank"}
*  [https://babeljs.io/blog/2019/03/19/7.4.0](https://babeljs.io/blog/2019/03/19/7.4.0){:target="_blank"}
*  [https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md](https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md){:target="_blank"}

