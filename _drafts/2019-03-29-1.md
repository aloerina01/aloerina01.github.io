---
title: React+Fluxアプリケーションにpropsバケツリレーは必要か
outline:
categories: [JavaScript, React, Flux]
---

React × Flux アプリケーションのメンテをしている中で「**propsのバケツリレーを減らすためにContainerを増やしてもよいか？**」というディスカッションになったので、考察をまとめてみます。


### 前提 既存の設計

* 一般的なFlux設計
* FluxUtilsフレームワークを利用している
* 複数のStoreを持つ
* ComponentTreeのRootをContainerとし、StoreのStateを受け取る
* 各Componentはprops経由でStoreのStateを受けとる
* 各Componentはローカルステートを持つことができる

ちなみに、ここで言うFluxの定義については「[React+Fluxで正しく設計するためのFlux見直しガイド]({% post_url /blog/2017-08-29-1 %})」にてまとめています。


### propsのバケツリレーと単一Containerとは？
Reactのアプリケーションでは、「ComponentTreeのRootでアプリケーション全体のStateを受け取り、それを何階層もの子Componentにprops経由で受け渡していく」という**単一Container**と**propsのバケツリレー**をちらほら見かけます。


* RootComponentから末端まで、2階層以上の深い階層へpropsを受け渡していること
* RootComponentが、Storeの状態を受け取る唯一のContainerであること


### propsのバケツリレーはどうやって生まれたのか

Reactは、ざっくり言うとComoponentを「propsを受け取り、それに応じた描画を返すもの」と定義しています。そしてComponentをTree上に並べることで画面を構成する仕組みです。これらをつなげると「何階層かのTree状に配置されたComponentにpropsを渡していく」ということになり、次第にReactの典型的な形となっていったのかもしれません。

> In a typical React application, data is passed top-down (parent to child) via props

Reactの公式ドキュメントにこうあるように、propsのバケツリレーはReactの典型例として認識されているようです。



### 公式ドキュメントの見解

* React ... 「典型的」とは言っているものの推奨している記述はなし
* Flux ... RootComponentをContainerとすることや、単一Containerとすることを推奨する記述はなし
* Redux ... 「いくつかのContainerをつくる」「RootComponent近くにContainerを置く義務はない」と記述

執筆時点の公式ドキュメントを見る限り、propsのバケツリレーや単一Containerを推奨する記述はありませんでした。