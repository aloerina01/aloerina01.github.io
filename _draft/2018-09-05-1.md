---
title: React+Fluxを正しく使いこなすための設計入門
outline: Action、Store、Dispatcher…よく聞くFluxの登場人物ですが、これらの責務とは何か。どう実装するのが良いのか。「なんとなく理解している」から「ちゃんと理解している」にステップアップするために整理したことを書き起こしました。
categories: ['React', 'Flux']
---

Reactの良さを活かしやすいFluxは、Webアプリケーションの設計手法としてずいぶん馴染みのあるものになったように感じます。私もFluxを取り入れた開発を2年近く経験し、知見も溜まり、使い慣れたような気持ちでいました。

が、使い始めた頃はもちろん、今でも何となく分かったつもりでいる部分があったり、複雑な実装が必要な場面で悩むことがあったりします。「Fluxはダメだ！うまく実現できない！」と放り出したくなるときもありますが、そんなときこそ基礎への立ち返る機会。  
そんなわけでFluxに再入門し、**Fluxとは何なのか、どう実装するのが適切なのか**を公式ドキュメントに則って整理してみようと思います。

* TOC
{:toc}

### Fluxとは

Fluxとは**アプリケーション内のデータの流れをどう扱うかについての設計パターン**です。

(がぞう)
出典

Fluxの代名詞的なこの図でも示されている通り、Fluxとは**データの流れを一方向に強制します**。データの流れを一方向にし、それを受け取る/送る4つの役割において**データをどう扱うか**を定義することで、アプリケーション内の見通しを良く保つ設計担っています。

#### Fluxの利点

Fluxを利用することで得られるメリットは大きく2つあります。

一つは(特定の)複雑さに強く、アプリケーションが大きくなっても破綻しにくいこと。  
Fluxは現代のWebアプリケーションでよくある**UIと複雑なデータ構造を持つアプリケーション**を想定して作られています。そのようなアプリケーションに必要な実装をAction,Dispatcher,Store,Viewという4つの役割に分離し、それぞれに**明確な責務**と**データの取り扱い方**を与えています(詳細は後述します)。  
この4つの役割を正しく理解し実装に落とし込むことで、アプリケーションが肥大化しても互いに疎結合で、一部の修正が他に影響せず、責務が分離された堅牢なアプリケーションを維持することができます。

もう一つは誰が実装しても同じような実装になり、破綻しにくいこと。  
上述の通り、アプリケーションに必要な責務を明確に4つに分けているため、「状態をどこで管理するべきか」「ビジネスロジックをどこに書くべきか」といったような実装の差(もしくは迷い)が生じにくくなります。実際にReact+FluxのアプリケーションとVue+MVVMのアプリケーションをチームで実装してみたときに、前者のほうが「何をどこに書くか」という観点での悩みは少なかったように感じます。  

※ FluxとMVVMのどちらが優れているかという話ではなく、「何をどこに書くか」という観点での認識のズレが起きにくいのがFluxだった、というだけの話です。認識のズレが起きにくいというのは規約が固く明確であるということで、言い換えればMVVMのほうが柔軟性が高く状況に応じて工夫を施しやすいという見方もできます。個人的にこの差は、「ViewModel」の柔軟さに起因するところが大きく、そこが良さでもあり難しさでもあると思っています。


#### MV*の歴史から見るFlux

MVCではある処理をする際、Controllerが処理の窓口となり、「まずViewにローディングアイコンを出し、次にモデルのデータを更新し、それをViewに反映し…」と宣言的に記述していくことになります。これだと規模が大きくなるにつれ複雑になっていったり、フロントの要件とは相性が悪かったりするので、一部をイベント駆動にしたりデータの持ち方を変えてみたりと試行錯誤した結果が、MV*なのだと認識しています。





* データフローを単方向にすること
* イベントドリブンだけど、普通のPub/Subじゃなくて全イベントを全コールバックに投げる
* StoreはStateの保持と「ロジック」を持つもの



### Action

アプリケーションに起きうるユースケースを表現する
ユースケースとは「ユーザがシステムを通じてする操作」(最適でわかりやすい表現を考える)
Actionは「このアプリケーションでどんなオペレーション・状態変化が起きるのか」を定義・列挙するもの
FluxはMV*の複雑さへの解として生まれたので、何が起きるかが一目瞭然になるというのは意味があること
actionはオブジェクト
かならずtypeを持つ
処理に必要なデータとtypeをセットにしてActionと呼ぶ
このデータをpayloadと呼ぶ

### Dispather



### Store




### View


