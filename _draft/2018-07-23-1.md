---
title: DartでWebフロントの開発はできる？ エコシステムから見るDartの現状
categories: [Dart]
outline: 
---
dartをつかってwebアプリのフロントエンドを作る上で必要なそうなエコシステムをリストアップ
	* dartのSDK
	* Projectの雛形の構築 → **stagehand**
	* パッケージ管理 → **pub, pubspec.yaml**
	* Build周り → **build.yaml**
		* dartをjsにする → **DDC, dart2js**
		* sassをcssにする → **sass_builder**
	* ローカルサーバとデバッグ環境 → **webdev**
		* 差分のwatch
		* ホットリロード

上のリストアップをそのままH3見出しにする。
最後に対応表を載せる。

最後はおまけとして、おすすめのドキュメントの読み進め方を書く。


### 参考資料の読み方
webAPPの開発に関する資料は、GetStartedが少々、AndularDart用の資料がそこそこ、あとはトピック毎の資料がたくさん、という感じだったので、体系的に離開していくのが大変でした。
なのでこの記事で体系立てて(既存のWeb開発の要件と対比させながら)整理することにしました。

最後の関連資料の相関図をまとめておきます。

[Tools | Dart](https://www.dartlang.org/tools)
	├ [Dart Tools for the Web | webdev.dartlang.org](https://webdev.dartlang.org/tools)
		├ webdev
		├ dart2js
		├ DDC
		└ build_runner
	├ [Dart VM Tools | Dart](https://www.dartlang.org/dart-vm/tools)
	└ [DartPad | Dart](https://www.dartlang.org/tools/dartpad)
記事のベースとなる情報はここ。DartってDocumentがめちゃ充実しててありがたいのだけど、情報量が多くてどこから読めばスムーズかつ体系的に理解できるのかがわかりにくかったので(そして全部英語だったので)、ここにそのあらましをまとめておきます。

### PolymerDart
PolymerDartはDartのエコシステムにWeb標準機能とPolymerを対応させるためのプロジェクト。このプロジェクトはPolymer1.x(クラシックなdart2js)と、WebComponents1.xと、DDCと[Bazel](https://github.com/dart-lang/bazel)ビルドシステムを活用したPolymer2.xをサポートする。

ちなみにBazelはMavenやGradleやMakeのようなビルドツール。Javaとかネイティブアプリとかのビルドができるツールなんだけど、`dazel`と称してDartのビルドする機能もある(dart製のカスタマイズBazel？)。
`pub run`使ってるならすぐ使えるようになると思うよ、[とのこと](https://github.com/dart-lang/bazel/tree/master/dazel)。


### Dartのバージョン
Dartを開発する上で欠かせないDartSDKは、執筆時時点()では安定版の`1.24.3`とプレリリース版の`2.0.0-dev.69.2`がああります。
DartはiOS、Android、Webの3つのClient開発言語としてのポジション。
https://medium.com/dartlang/announcing-dart-2-80ba01f43b6

普通にinstallしたら当然Dart1.xがはいる。

```shell
brew tap dart-lang/dart
brew install dart

# web利用の場合はDartVM付きブラウザDartiumを一緒にいれる
brew install --with-dartium --with-content-shell
```

で、Dart2へアップグレードする場合は
```shell
brew upgrade dart --devel --force
```

もしDartiumをいれちゃってる場合はDart2ではサポート対象外でUpgradeできないので入れ直し
```shell
brew uninstall dart
brew install dart --devel
```



### DDC(Dart Development Compiler
Dart1.xではDartiumやContentShellをつかってDartをブラウザで実行していたが、Dart2.xではDDCでコンパイルしてChrome(モダンウェブブラウザ)で実行できる。

ただし、でこれは`for Development only`。
リリースようには引き続き`dart2js`をつかってね、とのこと。


### dart2js
webdevのserveコマンド(ローカルサーバ立ち上げるコマンド)はデフォルトでDDCを使うようになっているが、`--release`オプションをつけることでdart2jsを使うようになっている。
逆にwebdevのbuildコマンドで`--no-release`をつけるとDDCを使う。

また、`--output`オプションを使うと、どのディレクトリをトップディレクトリとするかとどのディレクトリに排出するかを指定できる

```shell
webdev build --no-release --output web:build
```
たとえばこれは、DDCをつかって、webディレクトリをトップディレクリとしてビルドして、結果をbuildディレクトリに打ち込む。

基本的な使い方は
```shell
dart2js input.dart --out output.js
```

本番用には圧縮したいので
```shell
dart2js input.dart --out output.js -m 
```


### pub_runner
ビルドスクリプトをカスタマイズするためのもの。CLIでコンポーネントテストをするわけじゃないならwebdevで十分だよと公式にて。
依存関係を`pubspec.yaml`に書く。
```yml
dev_dependencies:
	build_runner:^0.9.0
  build_web_compilers: ^0.4.0
  build_test:^0.10.2
```
package.jsonの依存関係のようなもの。npmと同じくこれを手動で書く必要はなく、一般的には`pub get`や`pub upgrade`をつかうことで依存関係が追記されていく。

実行する時はこんな感じ
```shell
pub run build_runner build
pub run build_runner serve
```

ビルド時に設定を適用したい場合は`build.yaml`に書く(このファイル名がデフォルト)。すると勝手に適用される。名前を変えたい場合は`build.hoge.hyml`と命名して
```shell
pub run build_runner build --config hoge
```
とする。
設定ファイルに関するREADME：[build/README.md at master · dart-lang/build · GitHub](https://github.com/dart-lang/build/blob/master/build_config/README.md)

実用的な利用場面は`build.dev.yaml`と`build.prod.yaml`で設定を切り換えるとかかな。

ちなみに`webdev build`はデフォルトで`dart2js`が走って、`webdev serve`はデフォルトで`DDC`が走る。


### Webdev
またDart2.x用のビルドツールは`pub`ではなく`webdev`。

> The webdev package provides a command line interface (CLI) for users and tools to build and serve web apps. 

`pub build` → `webdev build`
`pub serve` → `webdev serve`

webdevのinstallはpubから
```shell
$ pub global activate webdev                 

Resolving dependencies... **(4.3s)**
+ **args** 1.4.4
+ **charcode** 1.1.2
+ **collection** 1.14.11
+ **io** 0.3.3
+ **meta** 1.1.6
+ **path** 1.6.2
+ **pub_semver** 1.4.2
+ **source_span** 1.4.1
+ **stack_trace** 1.9.3
+ **string_scanner** 1.0.3
+ **webdev** 0.2.3
+ **yaml** 2.1.15
Downloading **webdev** 0.2.3...
Downloading **stack_trace** 1.9.3...
Downloading **io** 0.3.3...
Downloading **yaml** 2.1.15...
Downloading **meta** 1.1.6...
Downloading **charcode** 1.1.2...
Downloading **path** 1.6.2...
Downloading **string_scanner** 1.0.3...
Downloading **source_span** 1.4.1...
Downloading **args** 1.4.4...
Downloading **pub_semver** 1.4.2...
Downloading **collection** 1.14.11...
Precompiling executables... **(1.4s)**
Precompiled **webdev:webdev**.
Installed executable **webdev**.
Warning: Pub installs executables into **$HOME/.pub-cache/bin**, which is not on your path.
You can fix that by adding this to your shell's config file (.bashrc, .bash_profile, etc.):

  **export PATH="$PATH":"$HOME/.pub-cache/bin"**

Activated **webdev** 0.2.3.
```


### DartのWebプロジェクトの初め方
[Get Started](https://webdev.dartlang.org/guides/get-started)の3章から。
`webdev`と`stagehand`をインストールせよ、とのこと。webdevは上記のもの。stagehandはプロジェクト構築CLI(Dart Project Generator)っぽい。

```shell
pub global activate webdev
pub global activate stagehand
```

packageの雛形はいくつかあって、Webアプリに関するものは
```
server-shelf ... web server用
web-angular ... angularDartを使ったWebフロント用
web-simple ... webフロント用の必要最低限(html, css, dart)
```

[stagehand/templates at master · dart-lang/stagehand · GitHub](https://github.com/dart-lang/stagehand/tree/master/templates)
ここを見れば実際に何がはいっているかわかる

とりあえず`web-simple`ではじめる
```shell
stagehand web-simple
```

vscodeでパッケージの雛形をつくったら「依存関係のあるライブラリがはいってないよ」とアラートが出て、勝手に`pub get`してくれた。イメージ的には「npm installしわすれてるからしてあげといたよ」って感じかな。
getして端末にインストールされたライブラリの情報は`.package`に、バージョン情報は`pubspec.lock`にかかれている感じかな？

一通り揃った感じがあるのでローカルサーバの立ち上げ
```shell
webdev serve
```
`localhost:8080`で確認できた。

`/web/main.dart`の一部を書き換えて保存したら自動で差分ビルドが走ってローカルサーバ上で更新。ブラウザでリロードしたら反映。このへんもWeb開発に近くて自然。

ここまでの所感。
npm install して npm start でローカルサーバ立ち上がって即開発開始！っていう感覚とほぼ同じなので違和感なく開発にとっかかれそう。


### pubspec.yml

```yml
dev_dependencies:
  build_runner: ^0.9.0
  build_web_compilers: ^0.4.0
```

`build_web_compiler`は「ブラウザでコードを実行したい人はつかう」Compiler。
([build_web_compilers | Dart Package](https://pub.dartlang.org/packages/build_web_compilers)参照)

これさえ書いてあれば、あとは自動生成されたビルドスクリプトがよしなにしてくれる。
(つまり何も書かなくてもビルドできる)

`webdev serve`はデフォルトでDDCを利用するので、dart2jsを使いたい場合は`build.yaml`を書く必要がある。

```yml
targets:
	$default:
		builders:
			build_web_compilers|entrypoint:
				generate_for:
				- test/**.browser_test.dart
				- web/**.dart
				options:
					compiler: dart2js
					dart2js_args:
						- --checked
```
[build/README.md at master · dart-lang/build · GitHub](https://github.com/dart-lang/build/blob/master/build_config/README.md)
[build/build_yaml_format.md at master · dart-lang/build · GitHub](https://github.com/dart-lang/build/blob/master/docs/build_yaml_format.md)




### 感想
仮想DOMを扱うVueやReactのWrapperがライブラリが出ればまじで来るんじゃないかな、Dart。